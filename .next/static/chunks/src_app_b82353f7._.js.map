{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///home/shercy/cycle-tracking/src/app/components/ProtectedRoute.js"],"sourcesContent":["\"use client\";\nimport { useEffect, useState } from \"react\";\nimport { useRouter } from \"next/navigation\";\nimport { useAppContext } from \"../context/AppContext\";\n\nexport default function ProtectedRoute({ children, allowedRoles }) {\n  const { user, token, isTokenExpired } = useAppContext();\n  const router = useRouter();\n  const [isLoading, setIsLoading] = useState(true);\n  const [isAuthorized, setIsAuthorized] = useState(false);\n\n  useEffect(() => {\n    const checkAuth = () => {\n      // No token means not authenticated\n      if (!token || isTokenExpired(token)) {\n        setIsAuthorized(false);\n        setIsLoading(false);\n        router.push(\"/login\");\n        return;\n      }\n\n      // Check role authorization if roles are specified\n      if (allowedRoles && user) {\n        if (!allowedRoles.includes(user.role)) {\n          setIsAuthorized(false);\n          setIsLoading(false);\n          router.push(\"/\"); // Redirect to home if role not allowed\n          return;\n        }\n      }\n\n      // If we have token and user passes role check\n      if (user) {\n        setIsAuthorized(true);\n        setIsLoading(false);\n      } else {\n        // Wait a bit more for user data to load\n        setTimeout(() => {\n          if (!user) {\n            setIsAuthorized(false);\n            setIsLoading(false);\n            router.push(\"/login\");\n          }\n        }, 1000);\n      }\n    };\n\n    checkAuth();\n  }, [token, user, allowedRoles, router, isTokenExpired]);\n\n  // Show loading spinner while checking authentication\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-background\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-pink-500 mx-auto\"></div>\n          <p className=\"mt-4 text-foreground/70\">Checking authentication...</p>\n        </div>\n      </div>\n    );\n  }\n\n  // Don't render children if not authorized\n  if (!isAuthorized) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-background\">\n        <div className=\"text-center\">\n          <h2 className=\"text-2xl font-semibold text-foreground mb-2\">\n            Access Denied\n          </h2>\n          <p className=\"text-foreground/70\">\n            You don&apos;t have permission to access this page.\n          </p>\n        </div>\n      </div>\n    );\n  }\n\n  return children;\n}\n"],"names":[],"mappings":";;;;AACA;AACA;AACA;;;AAHA;;;;AAKe,SAAS,eAAe,EAAE,QAAQ,EAAE,YAAY,EAAE;;IAC/D,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,cAAc,EAAE,GAAG,CAAA,GAAA,sIAAA,CAAA,gBAAa,AAAD;IACpD,MAAM,SAAS,CAAA,GAAA,qIAAA,CAAA,YAAS,AAAD;IACvB,MAAM,CAAC,WAAW,aAAa,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IAC3C,MAAM,CAAC,cAAc,gBAAgB,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IAEjD,CAAA,GAAA,6JAAA,CAAA,YAAS,AAAD;oCAAE;YACR,MAAM;sDAAY;oBAChB,mCAAmC;oBACnC,IAAI,CAAC,SAAS,eAAe,QAAQ;wBACnC,gBAAgB;wBAChB,aAAa;wBACb,OAAO,IAAI,CAAC;wBACZ;oBACF;oBAEA,kDAAkD;oBAClD,IAAI,gBAAgB,MAAM;wBACxB,IAAI,CAAC,aAAa,QAAQ,CAAC,KAAK,IAAI,GAAG;4BACrC,gBAAgB;4BAChB,aAAa;4BACb,OAAO,IAAI,CAAC,MAAM,uCAAuC;4BACzD;wBACF;oBACF;oBAEA,8CAA8C;oBAC9C,IAAI,MAAM;wBACR,gBAAgB;wBAChB,aAAa;oBACf,OAAO;wBACL,wCAAwC;wBACxC;kEAAW;gCACT,IAAI,CAAC,MAAM;oCACT,gBAAgB;oCAChB,aAAa;oCACb,OAAO,IAAI,CAAC;gCACd;4BACF;iEAAG;oBACL;gBACF;;YAEA;QACF;mCAAG;QAAC;QAAO;QAAM;QAAc;QAAQ;KAAe;IAEtD,qDAAqD;IACrD,IAAI,WAAW;QACb,qBACE,6LAAC;YAAI,WAAU;sBACb,cAAA,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAI,WAAU;;;;;;kCACf,6LAAC;wBAAE,WAAU;kCAA0B;;;;;;;;;;;;;;;;;IAI/C;IAEA,0CAA0C;IAC1C,IAAI,CAAC,cAAc;QACjB,qBACE,6LAAC;YAAI,WAAU;sBACb,cAAA,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAG,WAAU;kCAA8C;;;;;;kCAG5D,6LAAC;wBAAE,WAAU;kCAAqB;;;;;;;;;;;;;;;;;IAM1C;IAEA,OAAO;AACT;GA1EwB;;QACkB,sIAAA,CAAA,gBAAa;QACtC,qIAAA,CAAA,YAAS;;;KAFF","debugId":null}},
    {"offset": {"line": 162, "column": 0}, "map": {"version":3,"sources":["file:///home/shercy/cycle-tracking/src/app/profile/page.js"],"sourcesContent":["\"use client\";\nimport { useEffect, useState } from \"react\";\nimport { useAppContext } from \"@/app/context/AppContext\";\nimport { useForm } from \"react-hook-form\";\nimport ProtectedRoute from \"@/app/components/ProtectedRoute\";\nimport Link from \"next/link\";\nimport Image from \"next/image\";\n\nexport default function ProfilePage() {\n  const { user, setUser, token } = useAppContext();\n  const {\n    register,\n    handleSubmit,\n    setValue,\n    formState: { errors },\n  } = useForm();\n  const [error, setError] = useState(\"\");\n  const [success, setSuccess] = useState(\"\");\n  const [avatar, setAvatar] = useState(user?.avatar || \"\");\n\n  useEffect(() => {\n    if (user) {\n      setValue(\"username\", user.username);\n      setValue(\"email\", user.email);\n      setAvatar(user.avatar || \"\");\n    }\n  }, [user, setValue]);\n\n  const onSubmit = async (data) => {\n    try {\n      const res = await fetch(\"http://localhost:8080/api/profile\", {\n        method: \"PUT\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: `Bearer ${token}`,\n        },\n        body: JSON.stringify(data),\n      });\n      if (res.ok) {\n        const updatedUser = await res.json();\n        setUser(updatedUser);\n        setSuccess(\"Profile updated successfully\");\n        setError(\"\");\n      } else {\n        const result = await res.json();\n        setError(result.message || \"Failed to update profile\");\n        setSuccess(\"\");\n      }\n    } catch {\n      setError(\"Something went wrong\");\n      setSuccess(\"\");\n    }\n  };\n\n  const handleAvatarUpload = async (e) => {\n    const file = e.target.files[0];\n    if (!file) return;\n\n    const formData = new FormData();\n    formData.append(\"avatar\", file);\n\n    try {\n      const res = await fetch(\"http://localhost:8080/api/profile/avatar\", {\n        method: \"POST\",\n        headers: { Authorization: `Bearer ${token}` },\n        body: formData,\n      });\n      if (res.ok) {\n        const updatedUser = await res.json();\n        setUser(updatedUser);\n        setAvatar(updatedUser.avatar);\n        setSuccess(\"Avatar updated successfully\");\n        setError(\"\");\n      } else {\n        const result = await res.json();\n        setError(result.message || \"Failed to upload avatar\");\n      }\n    } catch {\n      setError(\"Something went wrong\");\n    }\n  };\n\n  return (\n    <ProtectedRoute allowedRoles={[\"user\", \"doctor\", \"admin\"]}>\n      <div className=\"p-6 max-w-4xl mx-auto\">\n        <h1 className=\"text-2xl font-semibold mb-4\">Your Profile</h1>\n        <div className=\"bg-background p-6 rounded-lg shadow-md\">\n          <div className=\"flex flex-col items-center mb-6\">\n            <Image\n              src={avatar || \"/default-avatar.png\"}\n              alt=\"Profile Avatar\"\n              width={128}\n              height={128}\n              className=\"rounded-full object-cover mb-4\"\n            />\n            <input\n              type=\"file\"\n              accept=\"image/*\"\n              onChange={handleAvatarUpload}\n              className=\"block w-full text-sm text-gray-300 file:mr-4 file:py-2 file:px-4 file:rounded-xl file:border-0 file:text-sm file:font-semibold file:bg-pink-500 file:text-white hover:file:bg-pink-600\"\n            />\n          </div>\n          <form onSubmit={handleSubmit(onSubmit)} className=\"space-y-4\">\n            <div>\n              <label className=\"block text-sm text-gray-300\">Username</label>\n              <input\n                type=\"text\"\n                {...register(\"username\", { required: \"Username is required\" })}\n                className=\"w-full mt-2 px-4 py-3 rounded-xl bg-[#2A3441] text-gray-200\"\n              />\n              {errors.username && (\n                <p className=\"text-red-500 text-sm\">\n                  {errors.username.message}\n                </p>\n              )}\n            </div>\n            <div>\n              <label className=\"block text-sm text-gray-300\">Email</label>\n              <input\n                type=\"email\"\n                {...register(\"email\", { required: \"Email is required\" })}\n                className=\"w-full mt-2 px-4 py-3 rounded-xl bg-[#2A3441] text-gray-200\"\n              />\n              {errors.email && (\n                <p className=\"text-red-500 text-sm\">{errors.email.message}</p>\n              )}\n            </div>\n            {error && <p className=\"text-red-500 text-sm\">{error}</p>}\n            {success && <p className=\"text-green-500 text-sm\">{success}</p>}\n            <button\n              type=\"submit\"\n              className=\"px-8 py-3 rounded-xl bg-pink-500 hover:bg-pink-600 text-white font-medium text-lg\"\n            >\n              Update Profile\n            </button>\n          </form>\n          <Link\n            href=\"/\"\n            className=\"mt-4 inline-block text-foreground/70 hover:text-foreground text-sm\"\n          >\n            Back to Home\n          </Link>\n        </div>\n      </div>\n    </ProtectedRoute>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}